(this.webpackJsonpffbooker=this.webpackJsonpffbooker||[]).push([[0],{74:function(e,t,a){e.exports=a(85)},79:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(11),c=a.n(l),s=(a(79),a(10)),o=a(12),u=a(19),i=a.n(u),m=a(51),d=a(33),f=a(37),b=a.n(f),p=a(136),g=a(131),E=a(135),v=a(134),k=a(130),O=a(132),j=a(133),C=a(126);var h=Object(p.a)({tableWrapper:{maxWidth:1e3,margin:"5px 0",backgroundColor:"#ffffffe0"},tableContainer:{maxHeight:"calc(100vh - 20px)",transition:"max-height 0.5s"},table:{minWidth:650,userSelect:"none"},thead:{"& th":{fontWeight:"bold",backgroundColor:"#b6ccdd"}}}),y=function(e){var t=function(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],l=a[1];return Object(n.useEffect)((function(){function t(){return a.apply(this,arguments)}function a(){return(a=Object(d.a)(i.a.mark((function t(){var a,n,r,l,c,s,o,u=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=function(e){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(1e3*e).getDay()]},c=function(e){return new Date(1e3*e).toLocaleDateString()},l=function(e){return new Date(1e3*e).toTimeString().substring(0,5)},a=u.length>0&&void 0!==u[0]?u[0]:1,console.log("Search Start"),console.log(e),n={programIds:e.paramClasses,fromDate:parseInt(Date.now()/1e3+e.fromDateAdj),toDate:parseInt(Date.now()/1e3+e.toDateAdj),pageSize:100,pageNumber:a,distance:2147483647,latitude:0,longitude:0},e.paramClub&&"FFP"!==e.paramClub&&(n.clubId=e.paramClub),t.next=10,b.a.ajax({type:"GET",url:"https://api-mobile.circuithq.com/api/v2/class/search",dataType:"json",headers:{Authorization:e.accessToken,"User-Country-Code":"sg"},data:n});case 10:return r=t.sent,o=(o=r.data).map((function(e){return{classId:e.classId,class:e.name,club:e.club.name,clubId:e.club.clubId,date:c(e.timeStart),day:s(e.timeStart),timestamp:e.timeStart,start:l(e.timeStart),end:l(e.timeEnd),capacity:e.capacity}})).filter((function(t){return t.capacity>0||!e.accessToken})),"FFP"===e.paramClub&&(o=o.filter((function(e){return 0===e.club.indexOf("FFP")}))),"No Work"===e.paramTime&&(o=o.filter((function(e){return"Sat"===e.day||"Sun"===e.day||parseInt(e.end)<=11||parseInt(e.start)>=20}))),t.abrupt("return",o);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}e.paramClasses&&Object(d.a)(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l([]),e.next=3,t();case 3:if(a=e.sent,console.log(a),l(a),!(a.length<30)){e.next=12;break}return e.next=9,t(2);case 9:n=e.sent,console.log(n),l([].concat(Object(m.a)(a),Object(m.a)(n)));case 12:case"end":return e.stop()}}),e)})))()}),[e.fromDateAdj,e.toDateAdj,e.paramClub,e.paramClasses,e.paramTime,e.accessToken]),r}(e),a=h(),l=null;return r.a.createElement(C.a,{elevation:3,className:a.tableWrapper},r.a.createElement(k.a,{className:a.tableContainer,style:{maxHeight:t.length?"":36}},r.a.createElement(g.a,{stickyHeader:!0,className:a.table,size:"small"},r.a.createElement(O.a,{className:a.thead},r.a.createElement(j.a,null,r.a.createElement(v.a,null,"ID"),r.a.createElement(v.a,null,"Club"),r.a.createElement(v.a,null,"Class"),r.a.createElement(v.a,null,"Date"),r.a.createElement(v.a,null,"Time"),r.a.createElement(v.a,null,"Capacity"))),r.a.createElement(E.a,null,t.sort((function(e,t){return e.timestamp-t.timestamp})).map((function(t){var a,n=l;return l=t.date,r.a.createElement(j.a,{key:t.classId,onClick:function(){return function(t){e.handleSelection(t)}(t)},style:{backgroundColor:(null===(a=e.selected)||void 0===a?void 0:a.classId)===t.classId?"#00d8f57d":"",boxShadow:null==n||t.date==n?"":"#b6ccdd 0 2px 0 0 inset"},hover:!0},r.a.createElement(v.a,null,t.classId),r.a.createElement(v.a,null,t.club),r.a.createElement(v.a,null,t.class),r.a.createElement(v.a,null,t.date," (",t.day,")"),r.a.createElement(v.a,null,t.start," - ",t.end),r.a.createElement(v.a,null,t.capacity))}))))))};var x=a(31),S=a(137),I=null;var T=function(e){var t,a,l,c,u,m,f,b,p=Object(n.useState)(parseInt(Date.now()/1e3)),g=Object(o.a)(p,2),E=g[0],v=g[1],k=Object(n.useReducer)((function(e,t){var a={};if("ADD"===t.action||"UPDATE"===t.action)a=Object(s.a)(Object(s.a)({},e),{},Object(x.a)({},t.target.classId,t.target));else if("REMOVE"===t.action){var n=Object(s.a)({},e);delete n[t.target.classId],a=n}return localStorage.setItem("watches",JSON.stringify(a)),a}),{},(function(e){var t=localStorage.getItem("watches");return t?JSON.parse(t):{}})),O=Object(o.a)(k,2),j=O[0],h=O[1],y=Object(n.useReducer)((function(e,t){return I=t,t}),null),T=Object(o.a)(y,2),F=T[0],J=T[1],B=w();Object(n.useEffect)((function(){Object(d.a)(i.a.mark((function t(){var a,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=0,n=0;case 2:if(null===F||null===I){t.next=16;break}return t.next=6,W(F,e.accessToken);case 6:if(!t.sent){t.next=13;break}return h({action:"UPDATE",target:Object(s.a)(Object(s.a)({},j[F]),{},{success:++a,fail:n})}),J(null),t.abrupt("break",19);case 13:h({action:"UPDATE",target:Object(s.a)(Object(s.a)({},j[F]),{},{success:a,fail:++n})});case 14:t.next=17;break;case 16:return t.abrupt("break",19);case 17:t.next=2;break;case 19:case"end":return t.stop()}}),t)})))()}),[F]),Object(n.useEffect)((function(){setInterval((function(e){v(parseInt(Date.now()/1e3))}),100)}),[]);var G=r.a.createElement("div",{style:D},r.a.createElement(C.a,{elevation:3,style:{backgroundColor:e.targetClass?j[e.targetClass.classId]?"#fdc4d2":"#c4f6fd":"",padding:5},className:B.preview},r.a.createElement("strong",null,"Class ID: ")," ",null===(t=e.targetClass)||void 0===t?void 0:t.classId," ",r.a.createElement("br",null),r.a.createElement("strong",null,"Club: ")," ",null===(a=e.targetClass)||void 0===a?void 0:a.club," ",r.a.createElement("br",null),r.a.createElement("strong",null,"Class: ")," ",null===(l=e.targetClass)||void 0===l?void 0:l.class," ",r.a.createElement("br",null),r.a.createElement("strong",null,"Date: ")," ",null===(c=e.targetClass)||void 0===c?void 0:c.date," (",null===(u=e.targetClass)||void 0===u?void 0:u.day,") ",r.a.createElement("br",null),r.a.createElement("strong",null,"Time: ")," ",null===(m=e.targetClass)||void 0===m?void 0:m.start," - ",null===(f=e.targetClass)||void 0===f?void 0:f.end," ",r.a.createElement("br",null),r.a.createElement("strong",null,"Capacity: ")," ",null===(b=e.targetClass)||void 0===b?void 0:b.capacity," ",r.a.createElement("br",null),e.targetClass&&!j[e.targetClass.classId]&&r.a.createElement(S.a,{component:C.a,style:Object(s.a)(Object(s.a)({},N),{},{backgroundColor:"#1c94f3b5"}),onClick:function(){return h({action:"ADD",target:e.targetClass})}},"Add"),e.targetClass&&j[e.targetClass.classId]&&r.a.createElement(S.a,{component:C.a,style:Object(s.a)(Object(s.a)({},N),{},{backgroundColor:"#f31c68b5"}),onClick:function(){return h({action:"REMOVE",target:e.targetClass})}},"Remove"))),M=r.a.createElement("div",{style:D},r.a.createElement(C.a,{elevation:3,style:{padding:"1px 5px 1px 5px",backgroundColor:"#ffffffd0"}},r.a.createElement("div",{style:{marginBottom:-6}},r.a.createElement("strong",null,"Execution Queue")),Object.keys(j).map((function(t){var a,n;return r.a.createElement("div",{key:t,style:A},r.a.createElement(C.a,{elevation:2,className:B.hoverPaper,onClick:function(a){return e.handleSelection(j[t])},style:{backgroundColor:(null===(a=e.targetClass)||void 0===a?void 0:a.classId)==t?"#99f3ff":"",padding:3}},r.a.createElement("div",{style:Object(s.a)(Object(s.a)({},P),{},{backgroundColor:F==t?"#d07dff":j[t].success?"#7dff84":j[t].fail?"#ff7daa":"#d0d0d0",boxShadow:(null===(n=e.targetClass)||void 0===n?void 0:n.classId)==t?"#00c4ffbf 0 0 99px 0 inset":"",margin:"-3px -3px 0",padding:"0 3px"})},r.a.createElement("strong",{style:{textDecoration:"underline"}},j[t].club),r.a.createElement("strong",null,": ",j[t].class)," (",j[t].classId,") ",r.a.createElement("br",null)),r.a.createElement("strong",null,j[t].date," (",j[t].day,")"),r.a.createElement("span",null," (",j[t].start," - ",j[t].end,")"),r.a.createElement("br",null),function(t){var a=t.timestamp-E-e.bookOpen-e.bookOffset,n=t.success?r.a.createElement("span",null,"SUCCESS: ",r.a.createElement("strong",{style:{color:"green"}},t.success)," "):"",l=t.fail?r.a.createElement("span",null,"FAILED: ",r.a.createElement("strong",{style:{color:"red"}},t.fail)):"",c=(n||l)&&r.a.createElement("div",null,n,l);if(a<=0&&a+e.bookDuration>=0&&null==F&&!c&&J(t.classId),F===t.classId){if((a+=e.bookDuration)>=0)return r.a.createElement("strong",null,r.a.createElement("span",{style:{color:"red"}},"...EXECUTING...")," (finish in ",a," s)",r.a.createElement("br",null),c);J(null)}else{if(a>=0){var s=parseInt(a/60/60/24),o=parseInt(a/60/60%24),u=parseInt(a/60%60),i=parseInt(a%60),m={color:s>0||o>3?"black":o>0?"orange":"red"},d=(s?s+"d ":"")+(o?o+"h ":"")+(u?u+"m ":"")+(i?i+"s ":"");return r.a.createElement("span",null,"Start Booking in ",r.a.createElement("strong",{style:m},d))}if(c)return r.a.createElement("span",null,c)}return r.a.createElement("span",null,"Invalid")}(j[t])))}))));return r.a.createElement(r.a.Fragment,null,G,!!Object.keys(j).length&&M)},w=Object(p.a)({hoverPaper:{"&:hover":{backgroundColor:"#ffffffff",transform:"scale(1.03)"},transition:"transform 0.1s",backgroundColor:"#ffffff80"},preview:{"&:hover":{backgroundColor:"#fffffff0",transition:"background-color 0.1s"},transition:"",backgroundColor:"#ffffffd0"}}),D={margin:"5px 0",flexGrow:1,userSelect:"none"},A={margin:"8px 0px",flexGrow:1},P={borderRadius:"5px 5px 0px 0px "},N={float:"right",margin:"-40px 5px"};function F(e){return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+"."+e.getMilliseconds()}function W(e,t){return J.apply(this,arguments)}function J(){return(J=Object(d.a)(i.a.mark((function e(t,a){var n,r,l,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Booking... "+t+" ("+F(new Date)+")"),n=(new Date).getTime(),e.prev=2,e.next=5,b.a.ajax({type:"POST",url:"https://api-mobile.circuithq.com/api/v2/class/book",dataType:"json",headers:{Authorization:a,"User-Country-Code":"sg"},data:{class_id:t}});case 5:return r=e.sent,console.table(r),l=(new Date).getTime(),console.log("["+(l-n)+"ms] Success... "+t+" ("+F(new Date)+")"),e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(2),console.table(JSON.parse(e.t0.responseText).error.messages),c=(new Date).getTime(),console.log("["+(c-n)+"ms] Failed... "+t+" ("+F(new Date)+")"),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}var B=a(146),G=a(145),M=a(142),R=a(86),U=a(148),z=a(147),H=a(138),q=a(139),L=a(140),V=a(143),Q=a(141);var X=function(e){var t=Object(n.useState)(e.accessToken),a=Object(o.a)(t,2),l=a[0],c=a[1],s=function(t){c(e.accessToken),e.setOpen(!1)};return r.a.createElement(z.a,{open:e.open,onClose:s},r.a.createElement(H.a,null,"Settings"),r.a.createElement(q.a,null,r.a.createElement(L.a,null,"Access Token is required for getting class capacity and booking classes."),r.a.createElement("br",null),r.a.createElement(V.a,{label:"Access Token",placeholder:"Bearer 58f7GciOiJIUzI1NiJ9.eyJpc3MiOiJodHRw3...",multiline:!0,fullWidth:!0,rows:8,variant:"outlined",InputLabelProps:{shrink:!0},value:l,onChange:function(e){return c(e.target.value)}})),r.a.createElement(Q.a,null,r.a.createElement(S.a,{onClick:s,color:"primary"},"Cancel"),r.a.createElement(S.a,{onClick:function(t){e.setAccessToken(l),localStorage.setItem("accessToken",l),e.setOpen(!1)},color:"primary"},"Save")))};var $=function(e){var t={All:null,FFP:"FFP",Paragon:4,Fusionopolis:10,"100AM":17},a={Access:[183,184,185,182],Bodyjam:[17]},l=Object(n.useState)(10),c=Object(o.a)(l,2),u=c[0],i=c[1],m=Object(n.useState)({Access:!0,Bodyjam:!0}),d=Object(o.a)(m,2),f=d[0],b=d[1],p=Object(n.useState)("No Work"),g=Object(o.a)(p,2),E=g[0],v=g[1],k=Object(n.useState)(!1),O=Object(o.a)(k,2),j=O[0],h=O[1];Object(n.useEffect)((function(){e.setParamClub(u),e.setParamClasses("["+Object.keys(f).filter((function(e){return f[e]})).map((function(e){return a[e]})).flat()+"]"),e.setParamTime(E)}));var y=K();return r.a.createElement("div",{style:_},r.a.createElement(C.a,{elevation:3,style:{padding:5},className:y.filter},r.a.createElement("span",{style:{float:"right"}},r.a.createElement(R.a,{onClick:function(e){return h(!0)}},r.a.createElement(U.a,{color:"action",fontSize:"small"})),r.a.createElement(X,{open:j,setOpen:h,accessToken:e.accessToken,setAccessToken:e.setAccessToken})),r.a.createElement("strong",null,"Club: "),r.a.createElement("br",null),Object.keys(t).map((function(e){return r.a.createElement("span",{key:e},r.a.createElement(M.a,{control:r.a.createElement(G.a,{checked:u===t[e],onChange:function(a){return i(t[e])}}),label:e}))})),r.a.createElement("br",null),r.a.createElement("strong",null,"Class: "),r.a.createElement("br",null),Object.keys(a).map((function(e){return r.a.createElement("span",{key:e},r.a.createElement(M.a,{control:r.a.createElement(B.a,{checked:f[e]||!1,onChange:function(t){return b(Object(s.a)(Object(s.a)({},f),{},Object(x.a)({},e,!f[e])))}}),label:e}))})),r.a.createElement("br",null),r.a.createElement("strong",null,"Time: "),r.a.createElement("br",null),["All","No Work"].map((function(e){return r.a.createElement("span",{key:e},r.a.createElement(M.a,{control:r.a.createElement(G.a,{checked:E===e,onChange:function(t){return v(e)}}),label:e}))})),r.a.createElement("br",null)))},_={margin:"5px 0",flexGrow:1,userSelect:"none"},K=Object(p.a)({filter:{"&:hover":{backgroundColor:"#fffffff0"},transition:"background-color 0.1s",backgroundColor:"#ffffffd0"}});a(84);var Y=function(){var e=Object(n.useState)((function(e){return localStorage.getItem("accessToken")||""})),t=Object(o.a)(e,2),a=t[0],l=t[1],c=Object(n.useReducer)((function(e,t){return(null===e||void 0===e?void 0:e.classId)!==(null===t||void 0===t?void 0:t.classId)?(console.log(t),t):null}),null),u=Object(o.a)(c,2),i=u[0],m=u[1],d=Object(n.useState)(null),f=Object(o.a)(d,2),b=f[0],p=f[1],g=Object(n.useState)(null),E=Object(o.a)(g,2),v=E[0],k=E[1],O=Object(n.useState)(null),j=Object(o.a)(O,2),C=j[0],h=j[1];function x(e){e.target==e.currentTarget&&m(null)}return r.a.createElement("div",{style:Object(s.a)(Object(s.a)({},Z),{},{display:"flex"}),onClick:x},r.a.createElement("div",{style:Object(s.a)(Object(s.a)({},ee),{},{maxWidth:1e3}),onClick:x},r.a.createElement(y,Object.assign({handleSelection:function(e){return m(e)},fromDateAdj:0,toDateAdj:511200,selected:i,accessToken:a},{paramClub:b,paramClasses:v,paramTime:C}))),r.a.createElement("div",{style:Object(s.a)(Object(s.a)({},ee),{},{minWidth:"325px",maxWidth:"400px",flexGrow:0}),onClick:x},r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement($,Object.assign({setParamClub:p,setParamClasses:k,setParamTime:h},{accessToken:a,setAccessToken:l})),r.a.createElement(T,{handleSelection:function(e){return m(e)},targetClass:i,bookOpen:165600,bookOffset:1,bookDuration:10,accessToken:a}))))},Z={position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:-1,padding:"0 5px"},ee={margin:"5px 5px",flexGrow:1};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[74,1,2]]]);
//# sourceMappingURL=main.4c735faf.chunk.js.map