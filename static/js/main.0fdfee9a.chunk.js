(this.webpackJsonpffbooker=this.webpackJsonpffbooker||[]).push([[0],{76:function(e,t,a){e.exports=a(87)},81:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(11),c=a.n(l),o=(a(81),a(10)),s=a(12),i=a(19),u=a.n(i),m=a(53),d=a(33),f=a(37),b=a.n(f),p=a(137),g=a(132),E=a(136),v=a(135),k=a(131),h=a(133),O=a(134),C=a(127);var j=Object(p.a)({tableWrapper:{maxWidth:1e3,margin:"5px 0",backgroundColor:"#ffffffe0"},tableContainer:{maxHeight:"calc(100vh - 20px)",transition:"max-height 0.5s"},table:{minWidth:650,userSelect:"none"},thead:{"& th":{fontWeight:"bold",backgroundColor:"#b6ccdd"}}}),y=function(e){var t=function(e){var t=Object(n.useState)([]),a=Object(s.a)(t,2),r=a[0],l=a[1];return Object(n.useEffect)((function(){function t(){return a.apply(this,arguments)}function a(){return(a=Object(d.a)(u.a.mark((function t(){var a,n,r,l,c,o,s,i=arguments;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=function(e){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(1e3*e).getDay()]},c=function(e){return new Date(1e3*e).toLocaleDateString()},l=function(e){return new Date(1e3*e).toTimeString().substring(0,5)},a=i.length>0&&void 0!==i[0]?i[0]:1,n={programIds:e.paramClasses,fromDate:parseInt(Date.now()/1e3+e.fromDateAdj),toDate:parseInt(Date.now()/1e3+e.toDateAdj),pageSize:100,pageNumber:a,distance:2147483647,latitude:0,longitude:0},"FFP"!==(null===e||void 0===e?void 0:e.paramClub)&&(n.clubId=e.paramClub),console.log("Search Start"),console.log(n),t.next=10,b.a.ajax({type:"GET",url:"https://api-mobile.circuithq.com/api/v2/class/search",dataType:"json",headers:{Authorization:e.accessToken,"User-Country-Code":"sg"},data:n});case 10:return r=t.sent,s=(s=r.data).map((function(e){return{classId:e.classId,class:e.name,club:e.club.name,clubId:e.club.clubId,date:c(e.timeStart),day:o(e.timeStart),timestamp:e.timeStart,duration:e.timeEnd-e.timeStart,start:l(e.timeStart),end:l(e.timeEnd),capacity:e.capacity,address:e.club.address}})).filter((function(t){return t.capacity>0||!e.accessToken})),"FFP"===e.paramClub&&(s=s.filter((function(e){return 0===e.club.indexOf("FFP")}))),"No Work"===e.paramTime&&(s=s.filter((function(e){return"Sat"===e.day||"Sun"===e.day||parseInt(e.end)<=11||parseInt(e.start)>=20}))),t.abrupt("return",s);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}e.paramClasses&&function(){var e=Object(d.a)(u.a.mark((function e(a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l([]),e.next=3,t();case 3:if(n=e.sent,a!==x){e.next=11;break}if(l(n),!(n.length<30)){e.next=11;break}return e.next=9,t(2);case 9:r=e.sent,a===x&&l([].concat(Object(m.a)(n),Object(m.a)(r)));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(++x)}),[e.fromDateAdj,e.toDateAdj,e.paramClub,e.paramClasses,e.paramTime,e.accessToken]),r}(e),a=j(),l=null;return r.a.createElement(C.a,{elevation:3,className:a.tableWrapper},r.a.createElement(k.a,{className:a.tableContainer,style:{maxHeight:t.length?"":36}},r.a.createElement(g.a,{stickyHeader:!0,className:a.table,size:"small"},r.a.createElement(h.a,{className:a.thead},r.a.createElement(O.a,null,r.a.createElement(v.a,null,"ID"),r.a.createElement(v.a,null,"Club"),r.a.createElement(v.a,null,"Class"),r.a.createElement(v.a,null,"Date"),r.a.createElement(v.a,null,"Time"),r.a.createElement(v.a,null,"Capacity"))),r.a.createElement(E.a,null,t.sort((function(e,t){return e.timestamp-t.timestamp})).map((function(t){var a,n=l;return l=t.date,r.a.createElement(O.a,{key:t.classId,onClick:function(){return function(t){e.handleSelection(t)}(t)},style:{backgroundColor:(null===(a=e.selected)||void 0===a?void 0:a.classId)===t.classId?"#00d8f57d":"",boxShadow:null==n||t.date==n?"":"#b6ccdd 0 2px 0 0 inset"},hover:!0},r.a.createElement(v.a,null,t.classId),r.a.createElement(v.a,null,t.club),r.a.createElement(v.a,null,t.class),r.a.createElement(v.a,null,t.date," (",t.day,")"),r.a.createElement(v.a,null,t.start," - ",t.end),r.a.createElement(v.a,null,t.capacity))}))))))},x=0;var S=a(28),w=a(138),I=a(88),T=a(139),D=Object(n.createContext)(!1),P=null;var A=function(e){var t,a,l,c,i,m,f,b,p,g=Object(n.useState)(parseInt(Date.now()/1e3)),E=Object(s.a)(g,2),v=E[0],k=E[1],h=Object(n.useReducer)((function(t,a){var n={};if("ADD"===a.action||"UPDATE"===a.action)n=Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},a.target.classId,a.target));else if("REMOVE"===a.action){var r=Object(o.a)({},t);delete r[a.target.classId],n=r}else"EXECUTE"===a.action&&(a.target.timestamp=v+e.bookOpen+e.bookOffset+3,n=Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},a.target.classId,a.target)));return localStorage.setItem("watches",JSON.stringify(n)),n}),{},(function(e){var t=localStorage.getItem("watches");return t?JSON.parse(t):{}})),O=Object(s.a)(h,2),j=O[0],y=O[1],x=Object(n.useReducer)((function(e,t){return P=t,t}),null),A=Object(s.a)(x,2),B=A[0],G=A[1],R=M(),z=Object(n.useContext)(D);Object(n.useEffect)((function(){Object(d.a)(u.a.mark((function t(){var a,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=0,n=0;case 2:if(null===B||null===P){t.next=11;break}return t.next=6,J(B,e.accessToken,z,e.bookWait);case 6:r=t.sent,console.log(r()),r().then((function(e){e?(y({action:"UPDATE",target:Object(o.a)(Object(o.a)({},j[B]),{},{success:++a,fail:n})}),G(null)):y({action:"UPDATE",target:Object(o.a)(Object(o.a)({},j[B]),{},{success:a,fail:++n})})})),t.next=12;break;case 11:return t.abrupt("break",14);case 12:t.next=2;break;case 14:case"end":return t.stop()}}),t)})))()}),[B]),Object(n.useEffect)((function(){setInterval((function(e){k(parseInt(Date.now()/1e3))}),100)}),[]);var H=function(e){return e.toISOString().replace(/[-:]/g,"").replace(/\d\d\.\d\d\d/,"00")},L=r.a.createElement("div",{style:W},r.a.createElement(C.a,{elevation:3,style:{backgroundColor:e.targetClass?j[e.targetClass.classId]?"#fdc4d2":"#c4f6fd":"",padding:5},className:R.preview},r.a.createElement("strong",null,"Class ID: ")," ",null===(t=e.targetClass)||void 0===t?void 0:t.classId," ",r.a.createElement("br",null),r.a.createElement("strong",null,"Club: ")," ",null===(a=e.targetClass)||void 0===a?void 0:a.club," (",null===(l=e.targetClass)||void 0===l?void 0:l.clubId,") ",r.a.createElement("br",null),r.a.createElement("strong",null,"Class: ")," ",null===(c=e.targetClass)||void 0===c?void 0:c.class," ",r.a.createElement("br",null),r.a.createElement("strong",null,"Date: ")," ",null===(i=e.targetClass)||void 0===i?void 0:i.date," (",null===(m=e.targetClass)||void 0===m?void 0:m.day,") ",r.a.createElement("br",null),r.a.createElement("strong",null,"Time: ")," ",null===(f=e.targetClass)||void 0===f?void 0:f.start," - ",null===(b=e.targetClass)||void 0===b?void 0:b.end," ",r.a.createElement("br",null),r.a.createElement("strong",null,"Capacity: ")," ",null===(p=e.targetClass)||void 0===p?void 0:p.capacity," ",r.a.createElement("br",null),r.a.createElement("div",{style:U},e.targetClass&&!j[e.targetClass.classId]&&r.a.createElement(w.a,{component:C.a,style:{backgroundColor:"#1c94f3b5"},onClick:function(){return y({action:"ADD",target:e.targetClass})}},"Add"),z&&e.targetClass&&j[e.targetClass.classId]&&r.a.createElement(w.a,{component:C.a,style:{backgroundColor:"#d21cf3"},onClick:function(){return y({action:"EXECUTE",target:e.targetClass})}},"Execute"),e.targetClass&&j[e.targetClass.classId]&&r.a.createElement(w.a,{component:C.a,style:{backgroundColor:"#f31c68b5"},onClick:function(){return y({action:"REMOVE",target:e.targetClass})}},"Remove")))),X=r.a.createElement("div",{style:Object(o.a)(Object(o.a)({},W),{},{overflowX:"hidden",overflowY:"overlay"})},r.a.createElement(C.a,{elevation:3,style:{padding:"1px 5px 1px 5px",backgroundColor:"#ffffffd0"}},r.a.createElement("div",{style:{marginBottom:-6}},r.a.createElement("strong",null,"Execution Queue")),Object.keys(j).map((function(t){var a,n;return r.a.createElement("div",{key:t,style:N},r.a.createElement(C.a,{elevation:2,className:R.hoverPaper,onClick:function(a){return e.handleSelection(j[t])},style:{backgroundColor:(null===(a=e.targetClass)||void 0===a?void 0:a.classId)==t?"#99f3ff":"",padding:3}},r.a.createElement("div",{style:Object(o.a)(Object(o.a)({},F),{},{backgroundColor:B==t?"#d07dff":j[t].success?"#7dff84":j[t].fail?"#ff7daa":"#d0d0d0",boxShadow:(null===(n=e.targetClass)||void 0===n?void 0:n.classId)==t?"#00c4ffbf 0 0 99px 0 inset":"",margin:"-3px -3px 0",padding:"0 3px"})},r.a.createElement("strong",{style:{textDecoration:"underline"}},j[t].club),r.a.createElement("strong",null,": ",j[t].class)," (",j[t].classId,") ",r.a.createElement("br",null)),r.a.createElement("strong",null,j[t].date," (",j[t].day,")"),r.a.createElement("span",null," (",j[t].start," - ",j[t].end,")"),r.a.createElement("br",null),function(t){var a=t.timestamp-v-e.bookOpen-e.bookOffset,n=t.success?r.a.createElement("span",null,"SUCCESS: ",r.a.createElement("strong",{style:{color:"green"}},t.success)," "):"",l=t.fail?r.a.createElement("span",null,"FAILED: ",r.a.createElement("strong",{style:{color:"red"}},t.fail)):"",c=(n||l)&&r.a.createElement("div",null,n,l);if(a<=0&&a+e.bookDuration>=0&&null==B&&!c&&G(t.classId),B===t.classId){if((a+=e.bookDuration)>=0)return r.a.createElement("strong",null,r.a.createElement("span",{style:{color:"red"}},"...EXECUTING...")," (finish in ",parseInt(a)," s)",r.a.createElement("br",null),c);G(null)}else{if(a>=0){var o=parseInt(a/60/60/24),s=parseInt(a/60/60%24),i=parseInt(a/60%60),u=parseInt(a%60),m={color:o>0||s>3?"black":s>0?"orange":"red"},d=(o?o+"d ":"")+(s?s+"h ":"")+(i?i+"m ":"")+(u?u+"s ":"");return r.a.createElement("span",null,"Start Booking in ",r.a.createElement("strong",{style:m},d))}if(c)return r.a.createElement("span",null,c)}return r.a.createElement("span",null,"Invalid")}(j[t]),r.a.createElement("div",{style:U},j[t].success&&r.a.createElement(I.a,{onClick:function(e){return(a=j[t]).calendarSaved=!0,y({action:"UPDATE",target:a}),void window.open("http://www.google.com/calendar/render?"+"action=TEMPLATE\n&text=".concat(a.class,"\n&dates=").concat(H(new Date(1e3*a.timestamp)),"/").concat(H(new Date(1e3*a.timestamp+1e3*(a.duration||5400))),"\n&details=").concat(a.club+": "+a.class,"\n&location=").concat(escape(a.address),"\n&trp=false\n&sprop=\n&sprop=name:"),"_blank");var a}},r.a.createElement(T.a,{color:j[t].calendarSaved?"disabled":"action",fontSize:"small"})))))}))));return r.a.createElement(r.a.Fragment,null,L,!!Object.keys(j).length&&X)},M=Object(p.a)({hoverPaper:{"&:hover":{backgroundColor:"#ffffffff",transform:"scale(1.03)"},transition:"transform 0.1s",backgroundColor:"#ffffff80"},preview:{"&:hover":{backgroundColor:"#fffffff0",transition:"background-color 0.1s"},transition:"",backgroundColor:"#ffffffd0"}}),W={margin:"5px 0",flexGrow:1,userSelect:"none"},N={margin:"8px 0px",flexGrow:1},F={borderRadius:"5px 5px 0px 0px "},U={float:"right",margin:"-40px 5px",gap:5,display:"grid",gridTemplateColumns:"auto auto"};function B(e){return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+"."+e.getMilliseconds()}function G(){return(G=Object(d.a)(u.a.mark((function e(t,a,n){var r,l,c,o,s,i,m;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Booking... "+t+" ("+B(new Date)+")"),r=(new Date).getTime(),e.prev=2,!n){e.next=13;break}return console.log("DEBUG"),l=Math.random()*Math.random()*Math.random(),c=Math.random()*Math.random()*Math.random(),e.next=9,new Promise((function(e){return setTimeout(e,50+l*c*2e4)}));case 9:if(!(Math.random()>.01)){e.next=11;break}throw{responseText:'{"error":{"messages":["Debug_Error"]}}'};case 11:e.next=18;break;case 13:return e.next=15,b.a.ajax({type:"POST",url:"https://api-mobile.circuithq.com/api/v2/class/book",dataType:"json",headers:{Authorization:a,"User-Country-Code":"sg"},data:{class_id:t}});case 15:o=e.sent,console.table(o),P=null;case 18:return s=(new Date).getTime(),console.log("["+(s-r)+"ms] Success... "+t+" ("+B(new Date)+")"),e.abrupt("return",!0);case 23:return e.prev=23,e.t0=e.catch(2),(i=JSON.parse(e.t0.responseText))&&i.message?console.error(i.message):i&&i.error&&i.error.messages?i.error.messages.forEach((function(e){return console.error(null===e||void 0===e?void 0:e.message)})):console.error(i),m=(new Date).getTime(),console.log("["+(m-r)+"ms] Failed... "+t+" ("+B(new Date)+")"),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[2,23]])})))).apply(this,arguments)}function J(e,t,a,n){var r=function(e,t,a){return G.apply(this,arguments)}(e,t,a).then((function(e){return Promise.resolve((function(t){return new Promise((function(t){return t(e)}))}))})),l=new Promise((function(e){return setTimeout(e,n)})).then((function(e){return function(e){return Promise.resolve(r.then((function(e){return Promise.resolve(e())})))}}));return Promise.race([r,l])}var R=a(149),z=a(148),H=a(145),L=a(144),X=a(150),q=a(140),_=a(141),Q=a(142),V=a(146),Y=a(143);var $=function(e){var t=Object(n.useState)(e.accessToken),a=Object(s.a)(t,2),l=a[0],c=a[1],o=function(t){c(e.accessToken),e.setOpen(!1)};return r.a.createElement(X.a,{open:e.open,onClose:o},r.a.createElement(q.a,null,"Settings"),r.a.createElement(_.a,null,r.a.createElement(Q.a,null,"Access Token is required for getting class capacity and booking classes."),r.a.createElement("br",null),r.a.createElement(V.a,{label:"Access Token",placeholder:"Bearer 58f7GciOiJIUzI1NiJ9.eyJpc3MiOiJodHRw3...",multiline:!0,fullWidth:!0,rows:8,variant:"outlined",InputLabelProps:{shrink:!0},value:l,onChange:function(e){return c(e.target.value)}})),r.a.createElement(Y.a,null,r.a.createElement(w.a,{onClick:o,color:"primary"},"Cancel"),r.a.createElement(w.a,{onClick:function(t){e.setAccessToken(l),localStorage.setItem("accessToken",l),e.setOpen(!1)},color:"primary"},"Save")))};var K=function(e){var t={All:null,FFP:"FFP",Paragon:4,"George St.":5,"One Raffle Quay":8,Fusionopolis:10,"100AM":17,Metropolis:18,Bugis:21},a={Access:[183,184,185,182],Bodyjam:[17]},l=Object(n.useState)(10),c=Object(s.a)(l,2),i=c[0],u=c[1],m=Object(n.useState)({Access:!0,Bodyjam:!0}),d=Object(s.a)(m,2),f=d[0],b=d[1],p=Object(n.useState)("No Work"),g=Object(s.a)(p,2),E=g[0],v=g[1],k=Object(n.useState)(!1),h=Object(s.a)(k,2),O=h[0],j=h[1];Object(n.useEffect)((function(){e.setParamClub(i),e.setParamClasses("["+Object.keys(f).filter((function(e){return f[e]})).map((function(e){return a[e]})).flat()+"]"),e.setParamTime(E)}));var y=ee();return r.a.createElement("div",{style:Z},r.a.createElement(C.a,{elevation:3,style:{padding:5},className:y.filter},r.a.createElement("span",{style:{float:"right"}},r.a.createElement(I.a,{onClick:function(e){return j(!0)}},r.a.createElement(L.a,{color:"action",fontSize:"small"})),r.a.createElement($,{open:O,setOpen:j,accessToken:e.accessToken,setAccessToken:e.setAccessToken})),r.a.createElement("strong",null,"Club: "),r.a.createElement("br",null),Object.keys(t).map((function(e){return r.a.createElement("span",{key:e},r.a.createElement(H.a,{control:r.a.createElement(z.a,{checked:i===t[e],onChange:function(a){return u(t[e])}}),label:e}))})),r.a.createElement("br",null),r.a.createElement("strong",null,"Class: "),r.a.createElement("br",null),Object.keys(a).map((function(e){return r.a.createElement("span",{key:e},r.a.createElement(H.a,{control:r.a.createElement(R.a,{checked:f[e]||!1,onChange:function(t){return b(Object(o.a)(Object(o.a)({},f),{},Object(S.a)({},e,!f[e])))}}),label:e}))})),r.a.createElement("br",null),r.a.createElement("strong",null,"Time: "),r.a.createElement("br",null),["All","No Work"].map((function(e){return r.a.createElement("span",{key:e},r.a.createElement(H.a,{control:r.a.createElement(z.a,{checked:E===e,onChange:function(t){return v(e)}}),label:e}))})),r.a.createElement("br",null)))},Z={margin:"5px 0",flexGrow:1,userSelect:"none"},ee=Object(p.a)({filter:{"&:hover":{backgroundColor:"#fffffff0"},transition:"background-color 0.1s",backgroundColor:"#ffffffd0"}});a(86);var te=function(){var e=Object(n.useState)((function(e){return localStorage.getItem("accessToken")||""})),t=Object(s.a)(e,2),a=t[0],l=t[1],c=Object(n.useReducer)((function(e,t){return(null===e||void 0===e?void 0:e.classId)!==(null===t||void 0===t?void 0:t.classId)?(console.log(t),t):null}),null),i=Object(s.a)(c,2),u=i[0],m=i[1],d=Object(n.useState)(null),f=Object(s.a)(d,2),b=f[0],p=f[1],g=Object(n.useState)(null),E=Object(s.a)(g,2),v=E[0],k=E[1],h=Object(n.useState)(null),O=Object(s.a)(h,2),C=O[0],j=O[1];function x(e){e.target==e.currentTarget&&m(null)}return r.a.createElement(D.Provider,{value:!1},r.a.createElement("div",{style:Object(o.a)(Object(o.a)({},ae),{},{display:"flex"}),onClick:x},r.a.createElement("div",{style:Object(o.a)(Object(o.a)({},ne),{},{maxWidth:1e3}),onClick:x},r.a.createElement(y,Object.assign({handleSelection:function(e){return m(e)},fromDateAdj:0,toDateAdj:511200,selected:u,accessToken:a},{paramClub:b,paramClasses:v,paramTime:C}))),r.a.createElement("div",{style:Object(o.a)(Object(o.a)({},ne),{},{minWidth:"325px",maxWidth:"400px",flexGrow:0}),onClick:x},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"100%"}},r.a.createElement(K,Object.assign({setParamClub:p,setParamClasses:k,setParamTime:j},{accessToken:a,setAccessToken:l})),r.a.createElement(A,{handleSelection:function(e){return m(e)},targetClass:u,bookOpen:165600,bookOffset:1,bookDuration:10,bookWait:150,accessToken:a})))))},ae={position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:-1,padding:"0 5px"},ne={margin:"5px 5px",flexGrow:1};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[76,1,2]]]);
//# sourceMappingURL=main.0fdfee9a.chunk.js.map